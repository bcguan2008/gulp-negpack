/*
	使用方法
	var area=new wgtArea({
		id:'wgt-area',
		value:'杭州',
		prov:'浙江省',
		city:'杭州',
		onchange:function(){
			//alert($O.toJson(this.getData()));
		}
	});
	*/
 /*
 * date:2012.03.12
 */
!(function($){
	
	var configs = {
			'id':'sw_mod_filter_area',
			end:0
		};
	
	function Area(cfg) {
		this.init(cfg);
	}
	
	$.extend(Area.prototype,{
				
			init:function(cfg){
				this.config = $.extend(true, {}, configs, cfg);
				
				var node	= $('#'+this.config.id);
				
				this.value 	= this.config.value || '所有地区';
				this.prov	= this.config.prov || '';
				this.city	= this.config.city || '';
				if($.isFunction(this.config.onchange)){
					this.onchange = this.config.onchange;
				}
				
				this._createHTML(node, this.value, this.prov, this.city);
				this._bindEvent(node);
			},
			
			getInfo:function(){
				return{
					value:this.value,
					prov:this.prov,
					city:this.city
				}
			},
			
			//生成产业带部分的HTML
			createIndustryDistrict:function(value, industryDistrictStr){
				var html = '';
				if(industryDistrictStr){
					html += '<div class="industryDistrict">产品集中地</div>';
					html += '<ul class="ab-industryDistrict-area fd-clear">'
					var industryDistrictArray = new Array();
					industryDistrictArray = industryDistrictStr.split('&');
					for(var i = 0; i < industryDistrictArray.length; i++){
						var industryDistrict = industryDistrictArray[i];
						var viewIndustryDistrict = industryDistrict;
						if((viewIndustryDistrict.indexOf('市') > 0 || viewIndustryDistrict.indexOf('县') > 0) && viewIndustryDistrict.indexOf('区') > 0){
							viewIndustryDistrict = viewIndustryDistrict.replace('市', '-');
							viewIndustryDistrict = viewIndustryDistrict.replace('县', '-');	
							viewIndustryDistrict = viewIndustryDistrict.replace('区', '');
						}
						
						html += '<li class="items">';
						html += '<a ';
						if(value == industryDistrict){
							html += 'class="nfocus"'
						}
						html += ' c="';
						html += industryDistrict;
						html += '"';
						html += ' v="';
						html += industryDistrict;
						html += '"';
						html += ' d="';
						html += industryDistrict;
						html += '"';
						html += ' p=""';
						html += ' href="#"';
						html += '>';
						html += viewIndustryDistrict;
						html += '</a>';
						html += '</li>';
					}
					html += '</ul>';
				}
				return html;
			},
		
			_createHTML:function(node, value, prov, city){
				
				var self = this;
				
				function focusArea(curVaule){
					if(value==curVaule){
						focusArea=function(){return''};
						return 'class="focus"';
					}
					return'';
				}
				
				function focusProv(cur,curVaule){
					if(prov==curVaule){
						focusProv=function(){return''};
						var i=0,
							lg=cur.city.length;
						while(i<lg){
							if(flagFocusCity(cur.city[i++])){return 'class="focus"';}
						}
						return'class="nfocus"';
					}
					return'';
				}
				
				function focusIndustryDistrict(curIndustryDistrict){
					if(value == curIndustryDistrict){
						return 'class=focus';
					}
					return '';
				}

				function flagFocusCity(curVaule){
					if(value==curVaule){
						return true;
					}
					return'';
				}
				
				function focusCity(curVaule){

					if(value==curVaule){
						focusCity=function(){return''};
						return 'class="focus"';
					}
					return'';
				}
				
				var curCity = $('#'+this.config.id).attr('currentProvince');
				var industryDistrictStr = $('#' + this.config.id).attr('industrydistricts');
				var html	= '<span class="Selected">'+value+'</span><div class="sw-ui-area-box"><div class="sw-ui-area-bg"></div>';
				if(!curCity){
					html+='<div class="sw-ui-area-body"><div class="ab-all"><a '+focusArea('所有地区')+' href="#" p="" c="" v="所有地区">所有地区</a></div>';
					html += self.createIndustryDistrict(value, industryDistrictStr);
				}
				//附近地区筛选相关逻辑处理
				else
				{
					html+='<div class="sw-ui-area-body"><div class="ab-all"><a '+focusArea('所有地区')+' href="#" p="" c="" v="所有地区">所有地区</a>';
					
					html+=(function(){
						var html='',
							i=0,
							j=0,
							cLg,
							lg = self.provs.length,
							cur='';
						while(i < self.provs.length){
							cur = self.provs[i++];
							if(cur.name==curCity){
								j=0;
								cLg=cur.city.length;
								
								html+='<div class="near-area">附近地区：</div><div class="ab-prov ab-pd"><div class="item"><a '+focusProv(cur,cur.name)+
								'class="near-city" href="#" p="'+cur.name+'" c="" v="'+cur.name+'" searchtrace="sale_search_sort_province_ip">'+cur.name.substr(0,5)+
								'</a><ul class="items">';

								while(j<cLg){
									html+='<li><a '+focusCity(cur.city[j])+' href="#" p="'+cur.name+'" c="'+cur.city[j]+'"'+
									(cur.city[j].length>5?' title="'+cur.city[j]+'"':'')+' v="'+cur.city[j]+'" searchtrace="sale_search_sort_city_ip">'+
									cur.city[j++].substr(0,5)+'</a></li>';
								}
							html+='</ul></div></div></div>';
							}
						}
						return html;
					})();
					html += self.createIndustryDistrict(value, industryDistrictStr);
				}
				
				html+=(function(){
				
					var html='',
						i=0,
						lg = self.areas.length,
						cur='';
					while(i<lg){
						cur = self.areas[i++];
						html+='<li><a  '+focusArea(cur.name)+' href="#" p="'+cur.province+'" c="" v="'+cur.name+'">'+cur.name.substr(0,5)+'</a></li>';
					}
					return '<ul class="ab-area fd-clear">'+html+'</ul>';
					
				})();
				html+=(function(){
					var html='',
						i=0,
						j=0,
						cLg,
						lg = self.provs.length,
						cur='';
					while(i<lg){
						cur = self.provs[i++];
						
						j=0;
						cLg=cur.city.length;	
						html+='<li class="item"><a '+focusProv(cur,cur.name)+' href="#" p="'+cur.name+'" c="" v="'+cur.name+'">'+cur.name+'</a><ul class="items">'
						while(j<cLg){
							html+='<li><a '+focusCity(cur.city[j])+' href="#" p="'+cur.name+'" c="'+cur.city[j]+'"'+(cur.city[j].length>5?' title="'+
							cur.city[j]+'"':'')+' v="'+cur.city[j]+'">'+cur.city[j++].substr(0,5)+'</a></li>';
						}
						html+='</ul></li>';
					}	
					return '<ul class="ab-prov">'+html+'</ul></div></div>';
				
				})();
				node.html(html);
			},
			
			//事件绑定
			_bindEvent:function(node){

				node.find('.item').each(function(i){
					
					var time;
					var item = $(this);
					item.bind('mouseover',function(e){
						clearTimeout(time);
						time=setTimeout(function(){item.addClass('show');},200); 
					});
				
					item.bind('mouseout',function(e){
						clearTimeout(time);
						time=setTimeout(function(){item.removeClass('show');},200); 
					});
				});
				
				var self=this,
					box=node.find('.sw-ui-area-box'),
					tr1;
					
				node.bind('mouseover',function(e){//注释为取消延迟
					clearTimeout(tr1);
					tr1=setTimeout(function(){box.show();},200);
				});
				
				node.bind('mouseout',function(e){//注释为取消延迟
					clearTimeout(tr1);
					tr1=setTimeout(function(){box.hide();},200);
				});
				
				box.bind('click', function(e){
				
					var tg=e.target ;
					if(tg.nodeName.toUpperCase()!='A')return;
					var value=tg.getAttribute('v'),
						prov=tg.getAttribute('p'),
						city=tg.getAttribute('c'),
						district = tg.getAttribute('d');
					if(prov!=self.prov||city!=self.city||value!=self.value){
						self.value=value;
						self.prov=prov,
						self.city=city;
						self.district=district;
						$(tg).addClass('focus');
						self.onchange();
						box.hide();
					}
					return false;
				});
			},
			

			areas:[//地区数据
				{name:'江浙沪',province:'江苏,浙江,上海'},
				{name:'华东区',province:'山东,江苏,安徽,浙江,福建,上海'},
				{name:'华南区',province:'广东,广西,海南'},
				{name:'华中区',province:'湖北,湖南,河南,江西'},
				{name:'华北区',province:'北京,天津,河北,山西,内蒙古'},
				{name:'北京',province:'北京'},
				{name:'上海',province:'上海'},
				{name:'天津',province:'天津'},
				{name:'重庆',province:'重庆'},
				{name:'海外',province:'海外'}
			],
			
			provs:[//省份数据
				{name:'广东',
					city:[
						'广州',
						'深圳',
						'珠海',
						'潮州',
						'中山',
						'东莞',
						'佛山',
						'惠州',
						'汕头',
						'汕尾',
						'韶关',
						'湛江',
						'肇庆',
						'河源',
						'江门',
						'揭阳',
						'茂名',
						'梅州',
						'清远',
						'阳江',
						'云浮'
					]
				},
				
				{name:'浙江',
					city:[
						'杭州',
						'宁波',
						'温州',
						'绍兴',
						'台州',
						'嘉兴',
						'金华',
						'丽水',
						'湖州',
						'衢州',
						'舟山'
					]
				},
				
				{name:'江苏',
					city:[
						'南京',
						'苏州',
						'无锡',
						'常州',
						'淮安',
						'镇江',
						'扬州',
						'徐州',
						'连云港',
						'南通',
						'宿迁',
						'泰州',
						'盐城'
					]
				},
				
				{name:'山东',
					city:[
						'济南',
						'青岛',
						'烟台',
						'济宁',
						'滨州',
						'莱芜',
						'日照',
						'潍坊',
						'淄博',
						'德州',
						'威海',
						'东营',
						'菏泽',
						'聊城',
						'临沂',
						'泰安',
						'枣庄'
					]
				},
				
				{name:'河北',
					city:[
						'石家庄',
						'保定',
						'沧州',
						'秦皇岛',
						'承德',
						'邯郸',
						'唐山',
						'邢台',
						'廊坊',
						'衡水',
						'张家口'
					]
				},
				
				{name:'河南',
					city:[
						'郑州',
						'洛阳',
						'开封',
						'焦作',
						'安阳',
						'南阳',
						'周口',
						'商丘',
						'新乡',
						'鹤壁',
						'平顶山',
						'三门峡',
						'信阳',
						'许昌',
						'驻马店',
						'漯河',
						'濮阳'
					]
				},
				
				{name:'福建',
					city:[
						'福州',
						'厦门',
						'泉州',
						'漳州',
						'龙岩',
						'南平',
						'宁德',
						'莆田',
						'三明'
					]
				},
				
				{name:'辽宁',
					city:[
						'沈阳',
						'大连',
						'鞍山',
						'丹东',
						'抚顺',
						'本溪',
						'朝阳',
						'铁岭',
						'锦州',
						'辽阳',
						'阜新',
						'葫芦岛',
						'盘锦',
						'营口'
					]
				},
				
				{name:'安徽',
					city:[
						'合肥',
						'芜湖',
						'马鞍山',
						'淮南',
						'蚌埠',
						'黄山',
						'阜阳',
						'淮北',
						'铜陵',
						'亳州',
						'宣城',
						'安庆',
						'巢湖',
						'池州',
						'六安',
						'滁州',
						'宿州'
					]
				},

				{name:'广西',
					city:[
						'南宁',
						'桂林',
						'北海',
						'柳州',
						'梧州',
						'玉林',
						'百色',
						'崇左',
						'贵港',
						'河池',
						'贺州',
						'来宾',
						'防城港',
						'钦州'
					]
				},
				
				{name:'山西',
					city:[
						'太原',
						'大同',
						'晋城',
						'晋中',
						'临汾',
						'吕梁',
						'朔州',
						'长治',
						'忻州',
						'阳泉',
						'运城'
					]
				},
				
				{name:'海南',
					city:[
						'海口',
						'三亚',
						'琼海',
						'东方',
						'儋州',
						'万宁',
						'文昌',
						'定安县',
						'五指山',
						'屯昌县',
						'澄迈县',
						'临高县',
						'白沙黎族自治县',
						'昌江黎族自治县',
						'乐东黎族自治县',
						'陵水黎族自治县',
						'琼中黎族苗族自治县',
						'保亭黎族苗族自治县'
					]
				},
				
				{name:'内蒙古',
					city:[
						'呼和浩特',
						'包头',
						'赤峰',
						'鄂尔多斯',
						'呼伦贝尔',
						'阿拉善盟',
						'通辽',
						'乌海',
						'兴安盟',
						'巴彦淖尔',
						'乌兰察布盟',
						'锡林郭勒盟'
					]
				},
				
				{name:'吉林',
					city:[
						'长春',
						'吉林',
						'四平',
						'通化',
						'白城',
						'白山',
						'辽源',
						'松原',
						'延边朝鲜族自治州'
					]
				},
				
				{name:'黑龙江',
					city:[
						'哈尔滨',
						'大庆',
						'佳木斯',
						'鹤岗',
						'牡丹江',
						'黑河',
						'鸡西',
						'七台河',
						'齐齐哈尔',
						'双鸭山',
						'绥化',
						'伊春',
						'大兴安岭'
					]
				},
				
				{name:'湖北',
					city:[
						'武汉',
						'黄冈',
						'黄石',
						'荆门',
						'荆州',
						'潜江',
						'宜昌',
						'鄂州',
						'十堰',
						'随州',
						'天门',
						'仙桃',
						'咸宁',
						'襄樊',
						'孝感',
						'神农架林区',
						'恩施土家族苗族自治州'
					]
				},
				
				{name:'湖南',
					city:[
						'长沙',
						'常德',
						'株洲',
						'岳阳',
						'郴州',
						'怀化',
						'湘潭',
						'张家界',
						'衡阳',
						'娄底',
						'邵阳',
						'益阳',
						'永州',
						'湘西土家族苗族自治州'
					]
				},
				
				{name:'江西',
					city:[
						'南昌',
						'上饶',
						'抚州',
						'赣州',
						'九江',
						'鹰潭',
						'吉安',
						'景德镇',
						'萍乡',
						'新余',
						'宜春'
					]
				},
				
				{name:'宁夏',
					city:[
						'银川',
						'固原',
						'石嘴山',
						'吴忠',
						'中卫'
					]
				},
				
				{name:'新疆',
					city:[
						'乌鲁木齐',
						'哈密',
						'和田',
						'喀什',
						'吐鲁番',
						'阿克苏',
						'阿拉尔',
						'石河子',
						'五家渠',
						'克拉玛依',
						'图木舒克',
						'昌吉回族自治州',
						'伊犁哈萨克自治州',
						'巴音郭楞蒙古自治州',
						'博尔塔拉蒙古自治州',
						'克孜勒苏柯尔克孜自治州',
						'塔城地区',
						'阿勒泰地区'
					]
				},
				
				{name:'青海',
					city:[
						'西宁',
						'海东',
						'果洛藏族自治州',
						'海北藏族自治州',
						'海南藏族自治州',
						'黄南藏族自治州',
						'玉树藏族自治州',
						'海西蒙古族藏族自治州'
					]
				},
				
				{name:'陕西',
					city:[
						'西安',
						'咸阳',
						'汉中',
						'安康',
						'宝鸡',
						'商洛',
						'铜川',
						'渭南',
						'延安',
						'榆林'
					]
				},
				
				{name:'甘肃',
					city:[
						'兰州',
						'白银',
						'酒泉',
						'定西',
						'嘉峪关',
						'金昌',
						'庆阳',
						'陇南',
						'平凉',
						'天水',
						'武威',
						'张掖',
						'甘南藏族自治州',
						'临夏回族自治州'
					]
				},
				
				{name:'四川',
					city:[
						'成都',
						'宜宾',
						'绵阳',
						'巴中',
						'攀枝花',
						'达州',
						'德阳',
						'遂宁',
						'广安',
						'广元',
						'乐山',
						'泸州',
						'眉山',
						'南充',
						'内江',
						'雅安',
						'资阳',
						'自贡',
						'甘孜藏族自治州',
						'凉山彝族自治州',
						'阿坝藏族羌族自治州'
					]
				},
				
				{name:'云南',
					city:[
						'昆明',
						'保山',
						'丽江',
						'玉溪',
						'昭通',
						'临沧',
						'曲靖',
						'普洱',
						'楚雄彝族自治州',
						'大理白族自治州',
						'迪庆藏族自治州',
						'怒江傈傈族自治州',
						'文山壮族苗族自治州',
						'西双版纳傣族自治州',
						'德宏傣族景颇族自治州',
						'红河哈尼族彝族自治州'
					]
				},
				
				{name:'贵州',
					city:[
						'贵阳',
						'安顺',
						'毕节',
						'铜仁',
						'遵义',
						'六盘水',
						'黔东南苗族侗族自治州',
						'黔南布依族苗族自治州',
						'黔西南布依族苗族自治州'
					]
				},
				
				{name:'西藏',
					city:[
						'拉萨',
						'阿里',
						'昌都',
						'林芝',
						'那曲',
						'日喀则',
						'山南'
					]
				},
				
				{name:'台湾',
					city:[
						'台北县',
						'宜兰县',
						'桃园县',
						'新竹县',
						'苗栗县',
						'台中县',
						'彰化县',
						'南投县',
						'云林县',
						'嘉义县',
						'台南县',
						'高雄县',
						'屏东县',
						'台东县',
						'花莲县',
						'澎湖县',
						'基隆市',
						'新竹市',
						'台中市',
						'嘉义市',
						'台南市',
						'台北市',
						'高雄市',
						'金门县',
						'连江县'
					]
				},
				
				{name:'香港',
					city:[
						'香港岛',
						'九龙',
						'新界'
					]
				},
				
				{name:'澳门',
					city:[
						'澳门半岛',
						'澳门离岛'
					]
				}
				
			],		
			end:0
	});
	
	Qingguo.Widget.Area = Area;
		
})(jQuery);




