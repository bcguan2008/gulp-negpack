
!(function($) {
	var Sandbox, config = {
		"formid" : "frmFiltSearch",
		end : 0
	};
	
	// 地区数据
	var areas = [
	         	{ name : '江浙沪', province : '江苏,浙江,上海' }, 
	         	{ name : '华东区', province : '山东,江苏,安徽,浙江,福建,上海' }, 
	         	{ name : '华南区', province : '广东,广西,海南' }, 
	         	{ name : '华中区', province : '湖北,湖南,河南,江西' }, 
	         	{ name : '华北区', province : '北京,天津,河北,山西,内蒙古' }, 
	         	{ name : '北京', province : '北京' }, 
	         	{ name : '上海', province : '上海' }, 
	         	{ name : '天津', province : '天津' }, 
	         	{ name : '重庆', province : '重庆' }, 
	         	{ name : '海外', province : '海外' } ];
	// 省份数据
	var provs = [
     			{ name : '广东', city : [ '广州', '深圳', '珠海', '潮州', '中山', '东莞', '佛山', '惠州', '汕头', '汕尾', '韶关', '湛江', '肇庆', '河源', '江门', '揭阳', '茂名', '梅州', '清远', '阳江', '云浮' ] }, 
     			{ name : '浙江', city : [ '杭州', '宁波', '温州', '绍兴', '台州', '嘉兴', '金华', '丽水', '湖州', '衢州', '舟山' ] }, 
     			{ name : '江苏', city : [ '南京', '苏州', '无锡', '常州', '淮安', '镇江', '扬州', '徐州', '连云港', '南通', '宿迁', '泰州', '盐城' ] }, 
     			{ name : '山东', city : [ '济南', '青岛', '烟台', '济宁', '滨州', '莱芜', '日照', '潍坊', '淄博', '德州', '威海', '东营', '菏泽', '聊城', '临沂', '泰安', '枣庄' ] }, 
     			{ name : '河北', city : [ '石家庄', '保定', '沧州', '秦皇岛', '承德', '邯郸', '唐山', '邢台', '廊坊', '衡水', '张家口' ] }, 
     			{ name : '河南', city : [ '郑州', '洛阳', '开封', '焦作', '安阳', '南阳', '周口', '商丘', '新乡', '鹤壁', '平顶山', '三门峡', '信阳', '许昌', '驻马店', '漯河', '濮阳' ] }, 
     			{ name : '福建', city : [ '福州', '厦门', '泉州', '漳州', '龙岩', '南平', '宁德', '莆田', '三明' ] }, 
     			{ name : '辽宁', city : [ '沈阳', '大连', '鞍山', '丹东', '抚顺', '本溪', '朝阳', '铁岭', '锦州', '辽阳', '阜新', '葫芦岛', '盘锦', '营口' ] }, 
     			{ name : '安徽', city : [ '合肥', '芜湖', '马鞍山', '淮南', '蚌埠', '黄山', '阜阳', '淮北', '铜陵', '亳州', '宣城', '安庆', '巢湖', '池州', '六安', '滁州', '宿州' ] }, 
     			{ name : '广西', city : [ '南宁', '桂林', '北海', '柳州', '梧州', '玉林', '百色', '崇左', '贵港', '河池', '贺州', '来宾', '防城港', '钦州' ] }, 
     			{ name : '山西', city : [ '太原', '大同', '晋城', '晋中', '临汾', '吕梁', '朔州', '长治', '忻州', '阳泉', '运城' ] }, 
     			{ name : '海南', city : [ '海口', '三亚', '琼海', '东方', '儋州', '万宁', '文昌', '定安县', '五指山', '屯昌县', '澄迈县', '临高县', '白沙黎族自治县', '昌江黎族自治县', '乐东黎族自治县', '陵水黎族自治县', '琼中黎族苗族自治县', '保亭黎族苗族自治县' ] },
     			{ name : '内蒙古', city : [ '呼和浩特', '包头', '赤峰', '鄂尔多斯', '呼伦贝尔', '阿拉善盟', '通辽', '乌海', '兴安盟', '巴彦淖尔', '乌兰察布盟', '锡林郭勒盟' ] }, 
     			{ name : '吉林', city : [ '长春', '吉林', '四平', '通化', '白城', '白山', '辽源', '松原', '延边朝鲜族自治州' ] }, 
     			{ name : '黑龙江', city : [ '哈尔滨', '大庆', '佳木斯', '鹤岗', '牡丹江', '黑河', '鸡西', '七台河', '齐齐哈尔', '双鸭山', '绥化', '伊春', '大兴安岭' ] }, 
     			{ name : '湖北', city : [ '武汉', '黄冈', '黄石', '荆门', '荆州', '潜江', '宜昌', '鄂州', '十堰', '随州', '天门', '仙桃', '咸宁', '襄樊', '孝感', '神农架林区', '恩施土家族苗族自治州' ] }, 
     			{ name : '湖南', city : [ '长沙', '常德', '株洲', '岳阳', '郴州', '怀化', '湘潭', '张家界', '衡阳', '娄底', '邵阳', '益阳', '永州', '湘西土家族苗族自治州' ] }, 
     			{ name : '江西', city : [ '南昌', '上饶', '抚州', '赣州', '九江', '鹰潭', '吉安', '景德镇', '萍乡', '新余', '宜春' ] }, 
     			{ name : '宁夏', city : [ '银川', '固原', '石嘴山', '吴忠', '中卫' ] }, 
     			{ name : '新疆', city : [ '乌鲁木齐', '哈密', '和田', '喀什', '吐鲁番', '阿克苏', '阿拉尔', '石河子', '五家渠', '克拉玛依', '图木舒克', '昌吉回族自治州', '伊犁哈萨克自治州', '巴音郭楞蒙古自治州', '博尔塔拉蒙古自治州', '克孜勒苏柯尔克孜自治州', '塔城地区', '阿勒泰地区' ] }, 
     			{ name : '青海', city : [ '西宁', '海东', '果洛藏族自治州', '海北藏族自治州', '海南藏族自治州', '黄南藏族自治州', '玉树藏族自治州', '海西蒙古族藏族自治州' ] }, 
     			{ name : '陕西', city : [ '西安', '咸阳', '汉中', '安康', '宝鸡', '商洛', '铜川', '渭南', '延安', '榆林' ] }, 
     			{ name : '甘肃', city : [ '兰州', '白银', '酒泉', '定西', '嘉峪关', '金昌', '庆阳', '陇南', '平凉', '天水', '武威', '张掖', '甘南藏族自治州', '临夏回族自治州' ] }, 
     			{ name : '四川', city : [ '成都', '宜宾', '绵阳', '巴中', '攀枝花', '达州', '德阳', '遂宁', '广安', '广元', '乐山', '泸州', '眉山', '南充', '内江', '雅安', '资阳', '自贡', '甘孜藏族自治州', '凉山彝族自治州', '阿坝藏族羌族自治州' ] }, 
     			{ name : '云南', city : [ '昆明', '保山', '丽江', '玉溪', '昭通', '临沧', '曲靖', '普洱', '楚雄彝族自治州', '大理白族自治州', '迪庆藏族自治州', '怒江傈傈族自治州', '文山壮族苗族自治州', '西双版纳傣族自治州', '德宏傣族景颇族自治州', '红河哈尼族彝族自治州' ] }, 
     			{ name : '贵州', city : [ '贵阳', '安顺', '毕节', '铜仁', '遵义', '六盘水', '黔东南苗族侗族自治州', '黔南布依族苗族自治州', '黔西南布依族苗族自治州' ] }, 
     			{ name : '西藏', city : [ '拉萨', '阿里', '昌都', '林芝', '那曲', '日喀则', '山南' ] }, 
     			{ name : '台湾', city : [ '台北县', '宜兰县', '桃园县', '新竹县', '苗栗县', '台中县', '彰化县', '南投县', '云林县', '嘉义县', '台南县', '高雄县', '屏东县', '台东县', '花莲县', '澎湖县', '基隆市', '新竹市', '台中市', '嘉义市', '台南市', '台北市', '高雄市', '金门县', '连江县' ] }, 
     			{ name : '香港', city : [ '香港岛', '九龙', '新界' ] },
     			{ name : '澳门', city : [ '澳门半岛', '澳门离岛' ] } ]; 
	
	function Filter(sb) {
		Sandbox = sb;
		return Filter;
	}

	$.extend(Filter, {
		init : function() {
			this.config = config;
			this.inputFilter();
		},
		inputFilter : function() {

			/* 下拉菜单初始化 */
			this.init_filter_select();

			if(!($.browser.msie && $.browser.version=='6.0')){
				/* 地区筛选初始化 */
				this.init_filter_area();
			}
		},
		/* 下拉菜单相关的事件及功能 */
		init_filter_select : function() {

			// select_arr与ul_arr的id是对应关系: 触发事件的页面元素和响应的页面元素.数组中存的是id
			// var select_arr=["#filter_bizetype", "#filter_orderMenu"];
			// var ul_arr=["#J_bizTypeList","#J_orderMenuList"];
			jQuery("#filter_biztype").bind("mouseover", function() {
				jQuery("#J_bizTypeList").css("display", "block");
			}).bind("mouseout", function() {
				jQuery("#J_bizTypeList").css("display", "none");
			});

			jQuery("#filter_membership").bind("mouseover", function() {
				jQuery("#J_membershipList").css("display", "block");
			}).bind("mouseout", function() {
				jQuery("#J_membershipList").css("display", "none");
			});
			
			jQuery("#filter_establishedyear").bind("mouseover", function() {
				jQuery("#J_establishedyear").css("display", "block");
			}).bind("mouseout", function() {
				jQuery("#J_establishedyear").css("display", "none");
			});
			
			jQuery("#filter_employeeCount").bind("mouseover", function() {
				jQuery("#J_employeeCountList").css("display", "block");
			}).bind("mouseout", function() {
				jQuery("#J_employeeCountList").css("display", "none");
			});
			
			jQuery("#filter_annualRevenue").bind("mouseover", function() {
				jQuery("#J_annualRevenueList").css("display", "block");
			}).bind("mouseout", function() {
				jQuery("#J_annualRevenueList").css("display", "none");
			});
		},
		/* 地区筛选初始化 */
		init_filter_area : function() {
			var self = this;
			var node = jQuery("#filter-area-cur");
			var focus = jQuery("#filter-area-cur .focus");
			var currValue=  node.attr("cur");// 当前select节点
			var prov = node.attr("province");// 省份表单
			var city = node.attr("city");
			
			this.addHtml(node,currValue,prov,city);
			this.bindEvent(node,currValue,prov,city,focus);
		},
		//构造地区html
		addHtml:function(node, value, prov, city) {
			// 注:由于变更,设置加亮背景被取消,故focus[...]3个函数直接被return'';(重新需要高亮，去掉return'')
			// 设置加亮背景
			function focusArea(curVaule) {
				// return'';
				if (value == curVaule) {
					focusArea = function() {
						return ''
					};
					return 'class="focus"';
				}
				return '';
			};
			function focusProv(cur, curVaule) {
				// return'';
				if (prov == curVaule) {
					focusProv = function() {
						return ''
					};
					var i = 0, lg = cur.city.length;
					while (i < lg) {
						if (flagFocusCity(cur.city[i++])) {
							return 'class="focus"';
						}
					}
					return 'class="nfocus"';
				}
				return '';
			};

			function flagFocusCity(curVaule) {
				if (value == curVaule) {
					return true;
				}
				return '';
			};
			function focusCity(curVaule) {
				// return'';
				if (value == curVaule) {
					focusCity = function() {
						return ''
					};
					return 'class="focus"';
				}
				return '';
			};
			var html = '';
				html = '<div class="wgt-areabox"><div class="wgt-areabg"></div>';
				html += '<div class="wgt-areabody"><div class="ab-all"><a rel="nofollow" href="javascript:;" p="" c="" v="所有地区">所有地区</a><a rel="nofollow" class="close" href="javascript:void(0);"></a>'
				+'</div>';
			html += (function() {
				var html = '', i = 0, lg = areas.length, cur = '';
				while (i < lg) {
					cur = areas[i++];
					html += '<li><a  ' + focusArea(cur.name) + ' rel="nofollow" href="javascript:;" p="' + cur.province + '" c="" v="' + cur.name + '">' + cur.name.substr(0, 5) + '</a></li>';
				}

				return '<ul class="ab-area fd-clear">' + html + '</ul>';
			})();
			html += (function() {
				var html = '', i = 0, j = 0, cLg, lg = provs.length, cur = '';
				while (i < lg) {
					cur = provs[i++];

					j = 0;
					cLg = cur.city.length;
					html += '<li class="item"><a ' + focusProv(cur, cur.name) + ' rel="nofollow" href="javascript:;" p="' + cur.name + '" c="" v="' + cur.name + '">' + cur.name + '</a><ul class="items">'
					while (j < cLg) {
						html += '<li><a ' + focusCity(cur.city[j]) + ' rel="nofollow" href="javascript:;" p="' + cur.name + '" c="' + cur.city[j] + '"'
								+ (cur.city[j].length > 5 ? ' title="' + cur.city[j] + '"' : '') + ' v="' + cur.city[j] + '">' + cur.city[j++].substr(0, 5)+ '</a></li>';
					}
					html += '</ul></li>';
				}
				return '<ul class="ab-prov">' + html + '</ul></div></div>';

			})();
			node.append(html);
		},
		bindEvent : function(node, currValue, currProv, currCity, focus) {
			/* 下拉选项框-地区下拉 */
			node.find(".item").bind("mouseover", function() {
				jQuery(this).addClass("show");
			}).bind("mouseout", function() {
				jQuery(this).removeClass("show");
			})
			var self = this, box = node.children(".wgt-areabox"), tr1;
			node.bind("mouseover", function() {
				clearTimeout(tr1);
				tr1 = setTimeout(function() {
					box.css("display", "block");
				}, 200);
			}).bind("mouseout", function() {
				clearTimeout(tr1);
				tr1 = setTimeout(function() {
					box.css("display", "none");
				}, 200);
			})
			
			$("#filter-area-cur").find("a").bind("click", function() {
				var tg = jQuery(this);
				var value = tg.attr('v');
				var prov = tg.attr('p');
				var city = tg.attr('c');
				
				
				if (prov != currProv || city != currCity || value != currValue) {
					
					var url = $("#filter-area").attr("areaurl");
				
					if (city) {
						url = url.replace(/defaultCity/, city);
					} else {
						url = url.replace(/defaultCity/, '');
					}
					if (prov) {
						url = url.replace(/defaultProvince/, prov);
					} else {
						url = url.replace(/defaultProvince/, '');
					}		
              
					focus.removeClass("focus");
					tg.addClass("focus");

					Qingguo.Utility.aliclick(this, "?searchtrace=w_com_filt_area");
					box.css("display", "none");
					window.location = url;
				}
			})
		},
		//设置表单空参数不提交
		setFormDisabled:function(){
			var self =this;
			jQuery("#" + self.config.formid + " > input").each(function(){
				if($(this).val()=="" || $(this).val()==undefined ){
					$(this).attr("disabled","disabled");
				}
			});
		},
		end : 0
	});
	Qingguo.Business.Filter = Filter;
	AppCore.register("qingguo_mod_filter", Qingguo.Business.Filter);

})(jQuery);