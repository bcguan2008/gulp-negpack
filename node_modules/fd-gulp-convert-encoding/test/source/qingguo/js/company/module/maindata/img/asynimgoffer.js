;(function($) {
	var AsynImgOffer, Sandbox, defConfig, requestURL, self, win, QU;
	QU = Qingguo.Utility;
    win = window;
	self = null;
	requestURL = "http://www.1688.com/chanpin/rpc/query.jsonp?_input_charset=utf-8&_output_charset=gbk";
	Sandbox = null;
	defConfig = {
	  url: requestURL,
	  data: {
		showStyle: "img"
	  }
	};
	
	AsynImgOffer = function(sb) {
	  Sandbox = sb;
	  return AsynImgOffer;
	};

	$.extend(AsynImgOffer, {
	  init: function() {
        self = this;

        self.collectParam();

        defConfig.success = self.successCallBack;
        defConfig.error = self.failCallBack;

        self.sendARequest();
		
	  },
	  
	  collectParam: function() {
        var formInput, item, requestData, _i, _len;

        formInput = $("#pageNavForm").serializeArray();
        requestData = {};

        for (_i = 0, _len = formInput.length; _i < _len; _i++) {
          item = formInput[_i];
          requestData[item.name] = item.value;
        }

        requestData.loadCount = 1;

        if (win.asynConfig != null) {
          requestData.industry = win.asynConfig.industry;
          requestData.beginPage = win.asynConfig.navigationPage;
        }

        $.extend(defConfig.data,requestData);
      },

      sendARequest: function() {
          QU.getRPCJsonp(defConfig.url, defConfig);
      },
	  
	  successCallBack: function(data) {
          self.renderHtml(data);
          Sandbox.notify(Qingguo.Config.Events.imgLazyLoadInit, null);
	  },
	  
	  failCallBack: function() {
		
	  },
	  
	  renderHtml: function(data) {
		var templateHtml;
		 // 打点
		Qingguo.Utility.aliclick(this, "?searchtrace=" + 'w_sale_asyn_load');
		if (typeof data === 'undefined' || data.length < 1) {
		  return 0;
		}
		
		if( typeof offerUrls === 'undefined' ){
			offerUrls = {};
		}
		app = {
			setUrl: function( oid, p4pClickUrl ) {
				offerUrls[0][oid] = p4pClickUrl;
			}
		};
		
		templateHtml = '<li class="fd-clr">\
            <h2 class="fd-clr">\
              <a class="company-name" rel="nofollow" title="义乌市逸昊电子商务商行" target="_blank" href="http://shop1364404095492.1688.com"><strong>义乌市逸昊电子商务商行</strong></a>\
              <a class="chengxintong" rel="nofollow" href="http://shop1368641113271.1688.com/page/creditdetail.htm" target="_blank"><i class="fui-ico-cxt16x16"></i>第<span class="CreditYear">1</span>年  </a>\
              <a class="deal-model" href="#" target="_blank"><i class="fui-ico-tradeLevel level-5"></i></a>\
          <span class="company-address">浙江省 义乌市</span>\
          </h2>\
              <div class="company-info">\
                  <div class="item">\
                      <em>主营产品：</em>\
                      <a target="_blank" href="http://dfyijiacn.1688.com/page/offerlist.htm?tracelog=p4p" rel="nofollow">手表; 电子礼品; 计时器; 防水手表</a>\
                  </div>\
                  <div class="item">\
                      <em>经营模式：</em>\
                      <a target="_blank" href="http://dfyijiacn.1688.com/page/offerlist.htm?tracelog=p4p" rel="nofollow">经销批发</a>\
                  </div>\
                  <div class="item">\
                      <em>工商注册：</em>\
                      <a target="_blank" href="http://dfyijiacn.1688.com/page/offerlist.htm?tracelog=p4p" rel="nofollow">2013（人民币300万元）</a>\
                  </div>\
                  <div class="item">\
                      <em>成交记录：</em>\
                      <a target="_blank" href="http://dfyijiacn.1688.com/page/offerlist.htm?tracelog=p4p" rel="nofollow">4715笔</a>\
                  </div>\
                  <div class="item">\
                      <em>厂房面积：</em>\
                      <a target="_blank" href="http://dfyijiacn.1688.com/page/offerlist.htm?tracelog=p4p" rel="nofollow">500平方米</a>\
                  </div>\
                  <div class="item">\
                      <em>年营业额：</em>\
                      <a target="_blank" href="http://dfyijiacn.1688.com/page/offerlist.htm?tracelog=p4p" rel="nofollow">100-900万元</a>\
                  </div>\
              </div>\
              <div class="company-brief">\
              逸昊百货主营 日用百货 饰品 创意小商品等。本公司加入义乌诚信通商盟。长期为各类客户提供最优质的货源，最优惠的价格。公司团队精心致力于广大客户的网内及线下服务，从下单-质检-出货-售后都有稳定的保障。“诚信经营 让利顾客”是我们逸昊人永远的宗旨！\
              </div>\
              <div class="company-related-pic fd-clr">\
                  <div class="company-pic">\
                      <div class="company-product-pic verticalImg">\
                          <a href="http://detail.1688.com/offer/1266193255.html" click-item="img" title="" target="_blank" class="boxImg">\
                              <img alt="【伙拼】高级半球保温电热水壶 烧水壶1.8L/升 家用电器 一件代发" src="http://wd.alibaba-inc.com/i/150-150.png" style="zoom: 1;">\
                              </a>\
                          </div>\
                          <div class="pic-detail">\
                              <a title="108颗红檀木佛珠手链手串 江湖地摊新产品热卖夜市爆款 2元店批发" target="_blank" href="http://detail.1688.com/offer/1264023432.html">108颗红檀木佛珠手链手串 江湖地摊新产品热卖夜市爆款 <font color="red">2元店</font>批发</a>\
                          </div>\
                      </div>\
                      <div class="company-pic">\
                          <div class="company-product-pic verticalImg">\
                              <a href="http://detail.1688.com/offer/1266193255.html" click-item="img" title="" target="_blank" class="boxImg">\
                                  <img alt="【伙拼】高级半球保温电热水壶 烧水壶1.8L/升 家用电器 一件代发" src="http://wd.alibaba-inc.com/i/150-150.png" style="zoom: 1;">\
                                  </a>\
                              </div>\
                              <div class="pic-detail">\
                                  <a title="108颗红檀木佛珠手链手串 江湖地摊新产品热卖夜市爆款 2元店批发" target="_blank" href="http://detail.1688.com/offer/1264023432.html">108颗红檀木佛珠手链手串 江湖地摊新产品热卖夜市爆款 <font color="red">2元店</font>批发</a>\
                              </div>\
                          </div>\
                          <div class="company-pic">\
                              <div class="company-product-pic verticalImg">\
                                  <a href="http://detail.1688.com/offer/1266193255.html" click-item="img" title="" target="_blank" class="boxImg">\
                                      <img alt="【伙拼】高级半球保温电热水壶 烧水壶1.8L/升 家用电器 一件代发" src="http://wd.alibaba-inc.com/i/150-150.png" style="zoom: 1;">\
                                      </a>\
                                  </div>\
                                  <div class="pic-detail">\
                                      <a title="108颗红檀木佛珠手链手串 江湖地摊新产品热卖夜市爆款 2元店批发" target="_blank" href="http://detail.1688.com/offer/1264023432.html">108颗红檀木佛珠手链手串 江湖地摊新产品热卖夜市爆款 <font color="red">2元店</font>批发</a>\
                                  </div>\
                              </div>\
                          </div>\
                      </li>';

          var html_re = '';
          for(var i = 0; i < 5; i++) {
              html_re += templateHtml;
          }
			
		$.use('web-sweet', function() {
		  var offers;

		  offers = FE.util.sweet(html_re).applyData(data, app);
		  $("ul.qg-offerresults", "#content").append(offers);
		  $("#offers_asyn").remove();
		  
		  Sandbox.notify(Qingguo.Config.Events.OfferAsyncOffer, {});
		});
	  }
	});
	Qingguo.Business.AsynImgOffer = AsynImgOffer;
	AppCore.lazyRegister("qingguo_mod_asynimgoffer", "Qingguo.Business.AsynImgOffer", "#offers_asyn", "exposure");
})(jQuery);