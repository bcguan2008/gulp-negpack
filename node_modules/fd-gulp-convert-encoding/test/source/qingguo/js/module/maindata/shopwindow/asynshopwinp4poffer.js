// Generated by CoffeeScript 1.6.2
/*
 The last 20 offers in maindata area asyn load
 AsynOfferShopwindowChild extends from base class AsynOffer
 @author dongming.jidm
 @date 2012-12-26
*/


(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  (function($) {
    var AsynShopWindowP4pOffer, defConfig, requestURL, self;

    self = null;
    requestURL = "http://www.1688.com/chanpin/rpc/queryP.jsonp?_input_charset=utf-8&_output_charset=gbk";
    defConfig = {
      url: requestURL,
      showStyle: "shopwindow"
    };
    AsynShopWindowP4pOffer = function() {
      return AsynShopWindowP4pOffer;
    };
    $.extend(AsynShopWindowP4pOffer, {
      init: function() {
        var AsynOfferShopwindowChild, asynOffer;

        self = this;
        AsynOfferShopwindowChild = (function(_super) {
          __extends(AsynOfferShopwindowChild, _super);

          function AsynOfferShopwindowChild() {
            this.renderData = __bind(this.renderData, this);            AsynOfferShopwindowChild.__super__.constructor.call(this, defConfig);
          }

          AsynOfferShopwindowChild.prototype.renderData = function(data) {
            self.renderHtml(data);
          };

          return AsynOfferShopwindowChild;

        })(Qingguo.Business.AsynOffer);
        asynOffer = new AsynOfferShopwindowChild(defConfig);
        asynOffer.run();
      },
      renderHtml: function(data) {
        var templateHtml;

        // 打点
        Qingguo.Utility.aliclick(this, "?searchtrace=" + 'w_sale_s_asyn_load');

        if (typeof data === 'undefined' || data.length < 1) {
          return 0;
        }

        if( typeof offerUrls === 'undefined' ){
          offerUrls = {};
        }
        app = {
          setUrl: function( oid, p4pClickUrl ) {
            offerUrls[0][oid] = p4pClickUrl;
          }
        };


        templateHtml = '<% for ( var i = 0; i < $data.length; i++ ) { %>\
                          <% if ( $data[i].isP4P ) { %>\
                            <%= this.setUrl($data[i].oid, $data[i].p4pClickUrl) %>\
                          <% } %>\
                          <li>\
                            <dl trace="offerTrace" rank="<%=i+1+20%>" offerId="<%=$data[i].offerId%>">\
                              <dt class="verticalImg">\
                                <a href="<%= $data[i].detailUrl %>" class="boxImg" click-item="img" target="_blank" t=<%= $data[i].isP4P ? $data[i].clickPrefix + "_offer_img_p4p" : $data[i].clickPrefix + "_offer_img" %> oid=<%= $data[i].isP4P ? $data[i].oid : "" %>><img data-lazyload-src="<%= $data[i].imgUrl.replace("summ","220x220") %>" alt="<%= $data[i].simpleSubject %>"></a>\
                              </dt>\
                              <dd class="description ms-yh">\
                                <a href="<%= $data[i].detailUrl %>" target="_blank" click-item="title" title="<%= $data[i].simpleSubject %>" t=<%= $data[i].isP4P ? $data[i].clickPrefix + "_offer_title_p4p" : $data[i].clickPrefix + "_offer_title" %> oid=<%= $data[i].isP4P ? $data[i].oid : "" %>><%= $data[i].subject %></a>\
                              </dd>\
                              <dd class="dealMount">\
							    <span class="sw-ui-font-price">\
							       <a href="<%= $data[i].detailUrl %>" click-item="price" target="_blank" t=<%= $data[i].clickPrefix + "_price" %> oid=<%= $data[i].isP4P ? $data[i].oid : "" %>>价格详情</a>\
                                </span>\
								<% if($data[i].showBookedCount) { %>\
                                  <span>\
                                    <a target="_blank" click-item="evaluate" href="<%= $data[i].evaluateUrl %>" t=<%= $data[i].clickPrefix + "_pj" %> oid=<%= $data[i].isP4P ? $data[i].oid : "" %>><%= $data[i].evaluateCounts %>条评价</a>\
                                  </span>\
								  <span>成交<%= $data[i].bookedCount %>笔</span>\
                                <% } %>\
                              </dd>\
                              <dd class="relatedProduct">\
								<% if(typeof $data[i].relateWordList !== "undefined" && $data[i].relateWordList != null && $data[i].relateWordList.length ) { %>\
                                <span>相关产品：</span>\
                                  <% for ( var k = 0; k < $data[i].relateWordList.length; k++ ) { %>\
                                    <a click-item="product" href="<%= $data[i].relateWordList[k].url %>" t=<%= $data[i].clickPrefix + "_related" %>><%= $data[i].relateWordList[k].word %></a>\
                                  <% } %>\
                                <% } %>\
                              </dd>\
                              <dd class="company">\
								<a class="<%= $data[i].statusStyle %>" href="#" alitalk="<%=$data[i].alitalkValue.replace("---","{").replace("__","}") %>" click-item=="alitalk" target="_self"></a>\
                                <a class="companyName" href="<%= $data[i].memberUrl %>" click-item="com" target="_blank" title="<%= $data[i].companyName %>" class="companyName" t=<%= $data[i].isP4P ? $data[i].clickPrefix + "_cn_p4p" : $data[i].clickPrefix + "_cn" %> oid=<%= $data[i].isP4P ? $data[i].oid : "" %>><%= $data[i].companyName %></a>\
							  </dd>\
								<dd class="icon">\
									<% if(typeof $data[i].trustCreditUrl !== "undefined" && $data[i].trustCreditUrl != null) { %>\
										<a rel="nofollow" click-item="tp" class="sw-ui-icon-mincxt" href="<%= $data[i].trustCreditUrl %>" target="_blank">\
											第<span class="CreditYear"><%= $data[i].tpServiceYear %></span>年\
										</a>\
									<% } %>\
									<% if(typeof $data[i].shidi !== "undefined" && $data[i].shidi === true) { %>\
										<a rel="nofollow" click-item="shidirenzheng" class="sw-ui-icon-trueLocation sm-offerResult-textTop"  href="http://view.1688.com/cms/safe/sdrz/buyer/0113/index.html" target="_blank"></a>\
									<% } %>\
									<% if(typeof $data[i].onlinetrade !== "undefined" && $data[i].onlinetrade === true) { %>\
										<a rel="nofollow" click-item="offeralipay" class="sw-ui-icon-alipay sm-offerResult-textTop"  href="http://view.1688.com/cms/services/aliguide/bd_zfb.html" target="_blank"></a>\
									<% } %>\
									<% if(typeof $data[i].buyerensure !== "undefined" && $data[i].buyerensure === true) { %>\
										<a rel="nofollow" click-item="paymentprotection" class="sw-ui-icon-payGuarantee sm-offerResult-textTop"  href="http://page.1688.com/buyerprotection/buyer.html" target="_blank"></a>\
									<% } %>\
									<% if(typeof $data[i].goldsupplier !== "undefined" && $data[i].goldsupplier === true) { %>\
										<a rel="nofollow" click-item="goldsupplier" class="sw-ui-icon-goldSupplier sm-offerResult-textTop"  href="http://page.1688.com/goldsupplier.html" target="_blank"></a>\
									<% } %>\
									<% if(typeof $data[i].mjdanganurl !== "undefined" && $data[i].mjdanganurl !== null) { %>\
										<a rel="nofollow" click-item="maijia" class="sw-ui-icon-mjdangan"  href="<%= $data[i].mjdanganurl %>" target="_blank">卖家档案</a>\
									<% } %>\
								</dd>\
                            </dl>\
                          </li>\
                      <% } %>\
                    ';
        $.use('web-sweet', function() {
          var offers;

          offers = FE.util.sweet(templateHtml).applyData(data, app);
          $("#sw_mod_searchlist", "#content").prepend(offers);
		  
		  Sandbox.notify(Qingguo.Config.Events.OfferAsyncOffer, {});
        });
      }
    });
    Qingguo.Business.AsynShopWindowP4pOffer = AsynShopWindowP4pOffer;
    AppCore.register("qingguo_mod_asynShopWindowP4pOffer", "Qingguo.Business.AsynShopWindowP4pOffer");
  })(jQuery);

}).call(this);
