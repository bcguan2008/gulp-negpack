/**
 * gallery view交互逻辑 
 */
define('detail.modules.gallery.Fav', 
        ['jQuery', 'Class', 'lang.Log'], 
function($, Class, Log) {
    var log = new Log('detail.modules.gallery.Fav');

return Class({
    
    init: function(view, config) {
        this.onEvent = $.os.supportsTouch ? 'tap' : 'click';
        
        var url = config.addToFavUrl,
            params = { 
                content_type: 'OFFER_BUY',
                content_id: config.offerId
            };
            
        // mock
        // url = 'http://purchase.1688.com/favorites/add_to_favorites.htm';
        // params.content_id = '1295681275';

        $('a.d-fav', view).on('click', function(e){
            e.preventDefault();
        });

        $('a.d-fav', view).on('tap', function(e){
            e.preventDefault();
            var elm = $(this);

            $.ajax(url, {
                dataType: 'jsonp',
                data: params,
                success: function(o){
                    Wing.navigator.tooltip('加入收藏夹成功');
                    log.info('加入收藏夹成功');
                    elm.addClass('d-fav-ed');
                },
                error: function(){
                    Wing.navigator.tooltip('加入收藏夹失败');
                    log.info('加入收藏夹失败');
                }
            });
        });
    }
});


});
